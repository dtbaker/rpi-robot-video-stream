<!doctype html>
<html>
<head>
	<title>Robot Cam</title>
	<style>
      * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
      }

      body, button {
          font: 18px Helvetica, Arial;
      }

      .start {
          display: flex;
          justify-content: center;
          align-items: center;
          height: 80vh;
      }

      .start button {
          padding: 40px;
      }

      .wrapper {
          display: none;
          flex-wrap: wrap;
      }

      .loading {
          display: none;
      }

      .video {
          flex: 0 0 640px;
          background: #efefef
      }

      .sidebar {
          flex: 1;
          padding: 20px;
      }

      .controls {
          display: flex;
          flex-wrap: wrap;
          justify-content: space-between;
      }

      .controls button {
          padding: 20px 10px;
          flex: 0 0 100%;
          margin: 10px 0;
      }

      .controls button.leftright {
          flex: 0 0 45%;
      }
	</style>
	<script src="/socket.io/socket.io.js"></script>
</head>
<body>
<div class="start" id="startWrapper">
	<button onclick="startThisThing()">Connect!</button>
</div>
<div class="loading" id="loadingWrapper">
	Waiting for robot to start......
</div>
<div class="wrapper" id="videoWrapper">
	<div class="video">
		<img src="" width="640" height="480" id="videoStream"/>
	</div>
	<div class="sidebar">
		<p>
			People Connected: <span id="clientCount">0</span>
		</p>
		<div class="controls">
			<button onclick="moveRobot('forward');">Forward</button>
			<button onclick="moveRobot('left');" class="leftright">Left</button>
			<button onclick="moveRobot('right');" class="leftright">Right</button>
			<button onclick="moveRobot('back');">Back</button>
		</div>
	</div>
</div>
<script>
  function b64(e) {
    var t = "";
    var n = new Uint8Array(e);
    var r = n.byteLength;
    for (var i = 0; i < r; i++) {
      t += String.fromCharCode(n[i])
    }
    return window.btoa(t)
  }

  var hasPlayed = false;

  function startThisThing() {
    document.getElementById('startWrapper').style.display = 'none';
    document.getElementById('loadingWrapper').style.display = 'flex';
    socket = io();
    socket.on('clientCount', function (clientCount) {
      document.getElementById('clientCount').innerText = clientCount;
    });
    socket.on('video', function (streamData) {
      if (!hasPlayed) {
        hasPlayed = true;
        document.getElementById('loadingWrapper').style.display = 'none';
        document.getElementById('videoWrapper').style.display = 'flex';
      }
      console.log('image!!')
      document.getElementById('videoStream').src = '/image?ts=' + streamData
    });
  }

  function moveRobot(direction) {
    socket.emit('moveRobot', direction)
  }
</script>
</body>
</html>
